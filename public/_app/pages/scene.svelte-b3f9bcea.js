import{a2 as I,W as N,a3 as M,a4 as V,S as j,i as q,s as H,e as g,k as S,t as T,c as d,a as h,m as C,h as L,d as u,b as W,g as p,J as m,j as x,l as v,K as y,a5 as J,v as K}from"../chunks/vendor-76251bbc.js";import{g as A}from"../chunks/navigation-bd39ff07.js";import"../chunks/singletons-a6a7384f.js";const R=/---?([\w\W]*?)---?/g,U=/(\w+):([\w\W]+):?([\w\W]+)?/g;function $(s){let e={type:"tag"};if(s.includes(`
`)){let n=s.split(`
`).map(i=>i.trim()).filter(i=>i!="");e.tag=n[0];for(let i=1;i<n.length;i++){const a=n[i].split(":");e[a[0].toLowerCase()]=a[1]}}else{s.matchAll(U);let n=s.split(":").map(i=>i.trim());e.name=n.shift().toLowerCase(),e.value=n,e.inline=!0}return e}async function z(s){let e=await I(s,{dir:N.Document}),n=e.matchAll(R);const i=[];Array.from(n).forEach(l=>{let o=$(l[1]),c=l[0].length,r=c+l.index;e=e.slice(0,l.index)+(`__tag${i.length}__`.padEnd(c," ")+e.slice(r)),i.push(o)});let a=e.split(`
`).map(l=>l.trim()).filter(l=>l!=""),t=[];return a.forEach((l,o)=>{let c=Array.from(l.matchAll(/__tag(\d)__/g));if(c==null?void 0:c[0])return t.push(i[c[0][1]]);let r=l.split(":").map(D=>D.trim());if(r.length<2)return t[t.length-1].lines.push(r[0]);let f=r[0],P=r[1],b=f.split("/");f=b[0];let _;b.length>1?_=b[1]:_="",t.push({type:"character",emotion:_,character:f,lines:[P]})}),t}const B=()=>{const s=M("__svelte__");return{page:{subscribe:s.page.subscribe},navigating:{subscribe:s.navigating.subscribe},get preloading(){return console.error("stores.preloading is deprecated; use stores.navigating instead"),{subscribe:s.navigating.subscribe}},session:s.session,updated:s.updated}},F={subscribe(s){return B().page.subscribe(s)}},k={scene:["name","background"],goto:["scene","label"],play:["media","volume"]},G={scene:async s=>{if(s.name&&V.appWindow.setTitle(s.name),s.bgmusic){let e=document.createElement("audio");e.src=s.bgmusic,e.loop=!0;try{await e.play()}catch(n){console.error(n)}}s.background&&(document.body.style.backgroundImage=`url('${s.background}')`)},goto:s=>{const e=new URLSearchParams({scene:s.scene,label:s.label});let n="/scene?"+e.toString();console.log("Moving to scene: "+n),A(n)}};function O(s){s.inline&&s.name in k&&(s.properties={},s.value.forEach((e,n)=>{s.properties[k[s.name][n]]=e})),G[s.name](s.properties)}function w(s){let e,n,i,a,t=s[0].name!="Narrator"&&E(s);return{c(){e=g("div"),t&&t.c(),n=S(),i=g("p"),a=T(s[1]),this.h()},l(l){e=d(l,"DIV",{class:!0});var o=h(e);t&&t.l(o),n=C(o),i=d(o,"P",{});var c=h(i);a=L(c,s[1]),c.forEach(u),o.forEach(u),this.h()},h(){W(e,"class","py-3 px-5 bg-black bg-opacity-30 text-white flex flex-col gap-6")},m(l,o){p(l,e,o),t&&t.m(e,null),m(e,n),m(e,i),m(i,a)},p(l,o){l[0].name!="Narrator"?t?t.p(l,o):(t=E(l),t.c(),t.m(e,n)):t&&(t.d(1),t=null),o&2&&x(a,l[1])},d(l){l&&u(e),t&&t.d()}}}function E(s){let e,n=s[0].name+"",i;return{c(){e=g("h3"),i=T(n)},l(a){e=d(a,"H3",{});var t=h(e);i=L(t,n),t.forEach(u)},m(a,t){p(a,e,t),m(e,i)},p(a,t){t&1&&n!==(n=a[0].name+"")&&x(i,n)},d(a){a&&u(e)}}}function Q(s){let e,n,i,a=s[0]&&w(s);return{c(){e=g("div"),n=S(),a&&a.c(),i=v(),this.h()},l(t){e=d(t,"DIV",{class:!0}),h(e).forEach(u),n=C(t),a&&a.l(t),i=v(),this.h()},h(){W(e,"class","frame")},m(t,l){p(t,e,l),p(t,n,l),a&&a.m(t,l),p(t,i,l)},p(t,[l]){t[0]?a?a.p(t,l):(a=w(t),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null)},i:y,o:y,d(t){t&&u(e),t&&u(n),a&&a.d(t),t&&u(i)}}}function X(s,e,n){let i;J(s,F,r=>n(3,i=r));let a;async function t(){const r=i.url.searchParams.get("scene");console.log("Loading scene at: "+r),a=await z(r),console.log(a),document.addEventListener("keyup",f=>{f.key==="Enter"&&c()})}let l,o;function c(){const r=a.shift();if(!r&&l.lines.length<1)return A("/");if(console.log(r),r.type=="tag")return O(r);n(0,l=r),n(1,o=l.lines.shift())}return K(t),[l,o]}class te extends j{constructor(e){super();q(this,e,X,Q,H,{})}}export{te as default};
